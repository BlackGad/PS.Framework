variables:
- group: FrameworkVersion
- name: SolutionRelativePath
  value: PS.Framework.sln
- name: Revision
  value: $[counter(variables['Minor'], 0)]

trigger:
  branches:
    include:
    - master
    - ci
    - Azure-Test-CI

pr: none

pool:
  vmImage: windows-2022

stages:
- stage: Change_Build_Version_Number
  jobs:
  - job: Change_Build_Version_Number
    steps:
     - checkout: none
     - task: AzurePowerShell@5
       inputs:
         scriptType: filePath
         scriptPath: $(Build.SourcesDirectory)/.pipelines/update-version-code-script.ps1
         scriptArguments:
           -URL $(System.CollectionUri)$(System.TeamProject)/_apis/distributedtask/variablegroups/1?api-version=6.0-preview.2 `
           -PAT $(System.AccessToken) `
           -MODE REVISION
         azurePowerShellVersion: latestVersion
         pwsh: true
         
#- stage: Build_And_Pack
#  jobs:
#  - job: Build
#    timeoutInMinutes: 0
#    displayName: Build
#    steps:
#    - checkout: self
#      path: s
#      target: host
#    - task: DotNetCoreCLI@2
#      displayName: Restore solution
#      inputs:
#        command: restore
#        projects: $(SolutionRelativePath)
#    - task: DotNetCoreCLI@2
#      displayName: Build solution
#      inputs:
#        command: build
#        arguments: -c Release --no-restore
#        projects: $(SolutionRelativePath)
#    - task: PublishBuildArtifacts@1
#      displayName: Publish Artifacts